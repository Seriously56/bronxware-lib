-- Nexus UI Library - Complete Working Version
local NexusUI = {}
NexusUI.__index = NexusUI

-- Services
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

-- Colors
NexusUI.Colors = {
    Background = Color3.fromRGB(15, 15, 25),
    Secondary = Color3.fromRGB(30, 25, 45),
    Accent = Color3.fromRGB(0, 255, 255),
    Energy = Color3.fromRGB(255, 50, 150),
    Text = Color3.fromRGB(255, 255, 255),
    Border = Color3.fromRGB(60, 60, 80)
}

-- ScreenGui Container
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "NexusUILibrary"
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")

-- Utility Functions
function NexusUI:Create(className, properties)
    local instance = Instance.new(className)
    for property, value in pairs(properties) do
        instance[property] = value
    end
    return instance
end

function NexusUI:RoundedCorners(radius)
    return self:Create("UICorner", {CornerRadius = UDim.new(0, radius or 8)})
end

function NexusUI:Stroke(thickness, color)
    return self:Create("UIStroke", {
        Thickness = thickness or 1,
        Color = color or self.Colors.Border,
        ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    })
end

-- Main Window
function NexusUI:Window(title)
    title = title or "Nexus Hub"
    
    local window = {}
    
    -- Main Frame
    local mainFrame = self:Create("Frame", {
        Parent = screenGui,
        Size = UDim2.new(0, 500, 0, 400),
        Position = UDim2.new(0.5, -250, 0.5, -200),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = self.Colors.Background,
        BackgroundTransparency = 0.1,
        BorderSizePixel = 0
    })
    
    -- Window Glow
    local glow = self:Stroke(3, self.Colors.Accent)
    glow.Transparency = 0.7
    glow.Parent = mainFrame
    
    -- Corners
    self:RoundedCorners(12).Parent = mainFrame
    
    -- Header
    local header = self:Create("Frame", {
        Parent = mainFrame,
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = self.Colors.Secondary,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(12).Parent = header
    
    -- Header Gradient
    local gradient = self:Create("UIGradient", {
        Parent = header,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, self.Colors.Secondary),
            ColorSequenceKeypoint.new(1, self.Colors.Accent)
        }),
        Rotation = 90
    })
    
    -- Title
    local titleLabel = self:Create("TextLabel", {
        Parent = header,
        Size = UDim2.new(1, -50, 1, 0),
        Position = UDim2.new(0, 15, 0, 0),
        BackgroundTransparency = 1,
        Text = title,
        TextColor3 = self.Colors.Text,
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Close Button
    local closeButton = self:Create("TextButton", {
        Parent = header,
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(1, -35, 0, 5),
        BackgroundColor3 = self.Colors.Energy,
        BackgroundTransparency = 0.2,
        Text = "X",
        TextColor3 = self.Colors.Text,
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(8).Parent = closeButton
    
    -- Content Frame
    local contentFrame = self:Create("Frame", {
        Parent = mainFrame,
        Size = UDim2.new(1, -20, 1, -60),
        Position = UDim2.new(0, 10, 0, 50),
        BackgroundTransparency = 1
    })
    
    -- Scroll Frame
    local scrollFrame = self:Create("ScrollingFrame", {
        Parent = contentFrame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = self.Colors.Accent,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        BorderSizePixel = 0
    })
    
    local uiListLayout = self:Create("UIListLayout", {
        Parent = scrollFrame,
        Padding = UDim.new(0, 10)
    })
    
    -- Update canvas size
    uiListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scrollFrame.CanvasSize = UDim2.new(0, 0, 0, uiListLayout.AbsoluteContentSize.Y)
    end)
    
    -- Window Methods
    function window:Show()
        mainFrame.Visible = true
    end
    
    function window:Hide()
        mainFrame.Visible = false
    end
    
    function window:Destroy()
        mainFrame:Destroy()
    end
    
    -- Close button functionality
    closeButton.MouseButton1Click:Connect(function()
        window:Hide()
    end)
    
    closeButton.MouseEnter:Connect(function()
        TweenService:Create(closeButton, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
    end)
    
    closeButton.MouseLeave:Connect(function()
        TweenService:Create(closeButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.2}):Play()
    end)
    
    window.MainFrame = mainFrame
    window.ContentFrame = scrollFrame
    
    return window
end

-- Button
function NexusUI:Button(props)
    props = props or {}
    
    local button = self:Create("TextButton", {
        Size = props.Size or UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = self.Colors.Secondary,
        BackgroundTransparency = 0.1,
        Text = props.Text or "Button",
        TextColor3 = self.Colors.Text,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        AutoButtonColor = false,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(8).Parent = button
    
    local stroke = self:Stroke(2, self.Colors.Accent)
    stroke.Transparency = 0.5
    stroke.Parent = button
    
    -- Hover effects
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = self.Colors.Accent}):Play()
        TweenService:Create(stroke, TweenInfo.new(0.2), {Transparency = 0}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = self.Colors.Secondary}):Play()
        TweenService:Create(stroke, TweenInfo.new(0.2), {Transparency = 0.5}):Play()
    end)
    
    -- Click effect
    button.MouseButton1Click:Connect(function()
        -- Ripple effect
        local ripple = self:Create("Frame", {
            Parent = button,
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundColor3 = self.Colors.Energy,
            BackgroundTransparency = 0.7,
            BorderSizePixel = 0
        })
        
        self:RoundedCorners(100).Parent = ripple
        
        TweenService:Create(ripple, TweenInfo.new(0.6), {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1
        }):Play()
        
        delay(0.6, function()
            ripple:Destroy()
        end)
        
        if props.Callback then
            props.Callback()
        end
    end)
    
    if props.Parent then
        button.Parent = props.Parent
    end
    
    return button
end

-- Toggle
function NexusUI:Toggle(props)
    props = props or {}
    
    local toggle = {
        Value = props.Default or false
    }
    
    local container = self:Create("Frame", {
        Size = props.Size or UDim2.new(1, 0, 0, 30),
        BackgroundTransparency = 1
    })
    
    local label = self:Create("TextLabel", {
        Parent = container,
        Size = UDim2.new(0.7, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = props.Text or "Toggle",
        TextColor3 = self.Colors.Text,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local toggleFrame = self:Create("Frame", {
        Parent = container,
        Size = UDim2.new(0, 50, 0, 25),
        Position = UDim2.new(1, -50, 0, 2),
        BackgroundColor3 = self.Colors.Secondary,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(12).Parent = toggleFrame
    
    local toggleButton = self:Create("Frame", {
        Parent = toggleFrame,
        Size = UDim2.new(0, 21, 0, 21),
        Position = UDim2.new(0, 2, 0, 2),
        BackgroundColor3 = self.Colors.Energy,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(10).Parent = toggleButton
    
    local function updateToggle()
        if toggle.Value then
            TweenService:Create(toggleButton, TweenInfo.new(0.2), {
                Position = UDim2.new(1, -23, 0, 2),
                BackgroundColor3 = self.Colors.Accent
            }):Play()
        else
            TweenService:Create(toggleButton, TweenInfo.new(0.2), {
                Position = UDim2.new(0, 2, 0, 2),
                BackgroundColor3 = self.Colors.Energy
            }):Play()
        end
    end
    
    container.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            toggle.Value = not toggle.Value
            updateToggle()
            if props.Callback then
                props.Callback(toggle.Value)
            end
        end
    end)
    
    updateToggle()
    
    function toggle:SetValue(value)
        toggle.Value = value
        updateToggle()
    end
    
    if props.Parent then
        container.Parent = props.Parent
    end
    
    toggle.Container = container
    return toggle
end

-- Label
function NexusUI:Label(props)
    props = props or {}
    
    local label = self:Create("TextLabel", {
        Size = props.Size or UDim2.new(1, 0, 0, 20),
        BackgroundTransparency = 1,
        Text = props.Text or "Label",
        TextColor3 = self.Colors.Text,
        Font = Enum.Font.Gotham,
        TextSize = props.TextSize or 14,
        TextXAlignment = props.Align or Enum.TextXAlignment.Left
    })
    
    if props.Parent then
        label.Parent = props.Parent
    end
    
    return label
end

-- Slider
function NexusUI:Slider(props)
    props = props or {}
    
    local slider = {
        Value = props.Default or props.Min or 0,
        Min = props.Min or 0,
        Max = props.Max or 100
    }
    
    local container = self:Create("Frame", {
        Size = props.Size or UDim2.new(1, 0, 0, 60),
        BackgroundTransparency = 1
    })
    
    local label = self:Create("TextLabel", {
        Parent = container,
        Size = UDim2.new(1, -50, 0, 20),
        BackgroundTransparency = 1,
        Text = props.Text or "Slider",
        TextColor3 = self.Colors.Text,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local valueLabel = self:Create("TextLabel", {
        Parent = container,
        Size = UDim2.new(0, 50, 0, 20),
        Position = UDim2.new(1, -50, 0, 0),
        BackgroundTransparency = 1,
        Text = tostring(slider.Value),
        TextColor3 = self.Colors.Accent,
        Font = Enum.Font.GothamBold,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Right
    })
    
    local track = self:Create("Frame", {
        Parent = container,
        Size = UDim2.new(1, 0, 0, 6),
        Position = UDim2.new(0, 0, 0, 30),
        BackgroundColor3 = self.Colors.Secondary,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(3).Parent = track
    
    local fill = self:Create("Frame", {
        Parent = track,
        Size = UDim2.new(0, 0, 1, 0),
        BackgroundColor3 = self.Colors.Accent,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(3).Parent = fill
    
    local handle = self:Create("Frame", {
        Parent = track,
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(0, 0, 0.5, -8),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundColor3 = self.Colors.Energy,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(8).Parent = handle
    
    local function updateSlider(value)
        local percentage = (value - slider.Min) / (slider.Max - slider.Min)
        fill.Size = UDim2.new(percentage, 0, 1, 0)
        handle.Position = UDim2.new(percentage, 0, 0.5, -8)
        valueLabel.Text = tostring(math.floor(value))
    end
    
    local dragging = false
    
    track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mouse = Players.LocalPlayer:GetMouse()
            local relativeX = (mouse.X - track.AbsolutePosition.X) / track.AbsoluteSize.X
            relativeX = math.clamp(relativeX, 0, 1)
            
            slider.Value = slider.Min + (relativeX * (slider.Max - slider.Min))
            updateSlider(slider.Value)
            
            if props.Callback then
                props.Callback(slider.Value)
            end
        end
    end)
    
    updateSlider(slider.Value)
    
    function slider:SetValue(value)
        slider.Value = math.clamp(value, slider.Min, slider.Max)
        updateSlider(slider.Value)
    end
    
    if props.Parent then
        container.Parent = props.Parent
    end
    
    slider.Container = container
    return slider
end

-- Tab System
function NexusUI:Tab(title)
    local tab = {}
    
    local button = self:Create("TextButton", {
        Size = UDim2.new(0, 100, 0, 30),
        BackgroundColor3 = self.Colors.Secondary,
        BackgroundTransparency = 0.2,
        Text = title,
        TextColor3 = self.Colors.Text,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        AutoButtonColor = false,
        BorderSizePixel = 0
    })
    
    self:RoundedCorners(6).Parent = button
    
    local contentFrame = self:Create("Frame", {
        Size = UDim2.new(1, 0, 1, -40),
        Position = UDim2.new(0, 0, 0, 40),
        BackgroundTransparency = 1,
        Visible = false
    })
    
    function tab:Show()
        contentFrame.Visible = true
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = self.Colors.Accent}):Play()
    end
    
    function tab:Hide()
        contentFrame.Visible = false
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = self.Colors.Secondary}):Play()
    end
    
    button.MouseButton1Click:Connect(function()
        if tab.OnClick then
            tab.OnClick()
        end
    end)
    
    tab.Button = button
    tab.Content = contentFrame
    
    return tab
end

return NexusUI
