-- NexusUI Part 1/3: Core setup
local NexusUI = {}
NexusUI.__index = NexusUI

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- Player
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Main container
local UI = Instance.new("ScreenGui")
UI.Name = "NexusUI"
UI.ResetOnSpawn = false
UI.Parent = CoreGui

-- Theme defaults
local Theme = {
    Primary = Color3.fromRGB(0, 170, 255),
    Secondary = Color3.fromRGB(35, 35, 35),
    Accent = Color3.fromRGB(0, 120, 255),
    Background = Color3.fromRGB(25, 25, 25),
    TextColor = Color3.fromRGB(255, 255, 255)
}

-- Utility functions
local function Tween(obj, properties, time, style, direction)
    style = style or Enum.EasingStyle.Quad
    direction = direction or Enum.EasingDirection.Out
    local tween = TweenService:Create(obj, TweenInfo.new(time, style, direction), properties)
    tween:Play()
    return tween
end

-- Draggable frames
local function MakeDraggable(frame)
    local dragging
    local dragInput
    local dragStart
    local startPos

    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
                                   startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

-- Window creation
function NexusUI:CreateWindow(title)
    local window = Instance.new("Frame")
    window.Name = title
    window.Size = UDim2.new(0, 400, 0, 300)
    window.Position = UDim2.new(0.5, -200, 0.5, -150)
    window.BackgroundColor3 = Theme.Background
    window.BorderSizePixel = 0
    window.Parent = UI

    MakeDraggable(window)

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 0, 30)
    titleLabel.BackgroundColor3 = Theme.Primary
    titleLabel.TextColor3 = Theme.TextColor
    titleLabel.Text = title
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 18
    titleLabel.Parent = window

    local content = Instance.new("Frame")
    content.Size = UDim2.new(1, 0, 1, -30)
    content.Position = UDim2.new(0, 0, 0, 30)
    content.BackgroundTransparency = 1
    content.Parent = window

    return {
        Window = window,
        Content = content,
        AddButton = function(self, text, callback)
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, -20, 0, 30)
            button.Position = UDim2.new(0, 10, 0, #content:GetChildren() * 35)
            button.BackgroundColor3 = Theme.Secondary
            button.TextColor3 = Theme.TextColor
            button.Text = text
            button.Font = Enum.Font.Gotham
            button.TextSize = 16
            button.Parent = content

            button.MouseButton1Click:Connect(callback)
        end
    }
end

return NexusUI

-- NexusUI Part 2/3: Toggles, Sliders, Dropdowns
local NexusUI = ...

-- Toggle
function NexusUI:AddToggle(windowTable, text, default, callback)
    default = default or false
    local content = windowTable.Content
    local index = #content:GetChildren() + 1

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 30)
    frame.Position = UDim2.new(0, 10, 0, (index - 1) * 35)
    frame.BackgroundColor3 = Theme.Secondary
    frame.Parent = content

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.8, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Theme.TextColor
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0.2, -5, 1, -5)
    toggleButton.Position = UDim2.new(0.8, 5, 0, 2)
    toggleButton.BackgroundColor3 = default and Theme.Accent or Theme.Primary
    toggleButton.Text = ""
    toggleButton.Parent = frame

    local toggled = default
    toggleButton.MouseButton1Click:Connect(function()
        toggled = not toggled
        toggleButton.BackgroundColor3 = toggled and Theme.Accent or Theme.Primary
        if callback then
            callback(toggled)
        end
    end)
end

-- Slider
function NexusUI:AddSlider(windowTable, text, min, max, default, callback)
    local content = windowTable.Content
    local index = #content:GetChildren() + 1

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 40)
    frame.Position = UDim2.new(0, 10, 0, (index - 1) * 45)
    frame.BackgroundColor3 = Theme.Secondary
    frame.Parent = content

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 15)
    label.BackgroundTransparency = 1
    label.Text = text .. " (" .. tostring(default) .. ")"
    label.TextColor3 = Theme.TextColor
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1, -10, 0, 15)
    sliderFrame.Position = UDim2.new(0, 5, 0, 20)
    sliderFrame.BackgroundColor3 = Theme.Primary
    sliderFrame.Parent = frame

    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    fill.BackgroundColor3 = Theme.Accent
    fill.Parent = sliderFrame

    local dragging = false
    local function updateSlider(x)
        local relative = math.clamp(x - sliderFrame.AbsolutePosition.X, 0, sliderFrame.AbsoluteSize.X)
        local value = min + ((relative / sliderFrame.AbsoluteSize.X) * (max - min))
        fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
        label.Text = text .. " (" .. math.floor(value) .. ")"
        if callback then callback(value) end
    end

    sliderFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            updateSlider(input.Position.X)
        end
    end)
    sliderFrame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateSlider(input.Position.X)
        end
    end)
end

-- Dropdown
function NexusUI:AddDropdown(windowTable, text, options, callback)
    local content = windowTable.Content
    local index = #content:GetChildren() + 1

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 30)
    frame.Position = UDim2.new(0, 10, 0, (index - 1) * 35)
    frame.BackgroundColor3 = Theme.Secondary
    frame.Parent = content

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Theme.TextColor
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local dropdownBtn = Instance.new("TextButton")
    dropdownBtn.Size = UDim2.new(0.3, -5, 1, -5)
    dropdownBtn.Position = UDim2.new(0.7, 5, 0, 2)
    dropdownBtn.BackgroundColor3 = Theme.Primary
    dropdownBtn.Text = "â–¼"
    dropdownBtn.Parent = frame

    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(0, 0, 0, 0)
    dropdownFrame.Position = UDim2.new(0, 0, 0, 30)
    dropdownFrame.BackgroundColor3 = Theme.Secondary
    dropdownFrame.ClipsDescendants = true
    dropdownFrame.Parent = frame

    local open = false
    dropdownBtn.MouseButton1Click:Connect(function()
        open = not open
        if open then
            dropdownFrame:TweenSize(UDim2.new(1, 0, 0, #options * 25), "Out", "Quad", 0.3, true)
        else
            dropdownFrame:TweenSize(UDim2.new(1, 0, 0, 0), "Out", "Quad", 0.3, true)
        end
    end)

    for i, option in ipairs(options) do
        local optBtn = Instance.new("TextButton")
        optBtn.Size = UDim2.new(1, 0, 0, 25)
        optBtn.Position = UDim2.new(0, 0, 0, (i - 1) * 25)
        optBtn.BackgroundColor3 = Theme.Primary
        optBtn.TextColor3 = Theme.TextColor
        optBtn.Text = option
        optBtn.Font = Enum.Font.Gotham
        optBtn.TextSize = 14
        optBtn.Parent = dropdownFrame

        optBtn.MouseButton1Click:Connect(function()
            if callback then callback(option) end
            dropdownFrame:TweenSize(UDim2.new(1, 0, 0, 0), "Out", "Quad", 0.3, true)
            open = false
        end)
    end
end

return NexusUI

-- NexusUI Part 3/3: Tabs, Notifications, Theme
local NexusUI = ...

-- Tabs
function NexusUI:AddTab(windowTable, tabName)
    local content = windowTable.Content
    local tabsFrame = windowTable.Tabs or Instance.new("Frame")
    if not windowTable.Tabs then
        tabsFrame.Size = UDim2.new(1, 0, 0, 30)
        tabsFrame.BackgroundTransparency = 1
        tabsFrame.Parent = content
        windowTable.Tabs = tabsFrame
        windowTable.CurrentTabContent = Instance.new("Frame")
        windowTable.CurrentTabContent.Size = UDim2.new(1, 0, 1, -30)
        windowTable.CurrentTabContent.Position = UDim2.new(0, 0, 0, 30)
        windowTable.CurrentTabContent.BackgroundTransparency = 1
        windowTable.CurrentTabContent.Parent = content
    end

    local tabButton = Instance.new("TextButton")
    tabButton.Size = UDim2.new(0, 100, 1, 0)
    tabButton.Position = UDim2.new(#tabsFrame:GetChildren() * 100, 0, 0, 0)
    tabButton.BackgroundColor3 = Theme.Primary
    tabButton.TextColor3 = Theme.TextColor
    tabButton.Text = tabName
    tabButton.Font = Enum.Font.Gotham
    tabButton.TextSize = 14
    tabButton.Parent = tabsFrame

    local tabContent = Instance.new("Frame")
    tabContent.Size = UDim2.new(1, 0, 1, -30)
    tabContent.BackgroundTransparency = 1
    tabContent.Visible = false
    tabContent.Parent = content

    tabButton.MouseButton1Click:Connect(function()
        for _, child in pairs(content:GetChildren()) do
            if child:IsA("Frame") and child ~= tabsFrame then
                child.Visible = false
            end
        end
        tabContent.Visible = true
        windowTable.CurrentTabContent = tabContent
    end)

    return tabContent
end

-- Notifications
function NexusUI:Notify(title, text, duration)
    duration = duration or 3
    local notifyFrame = Instance.new("Frame")
    notifyFrame.Size = UDim2.new(0, 250, 0, 60)
    notifyFrame.Position = UDim2.new(1, -260, 1, -70)
    notifyFrame.BackgroundColor3 = Theme.Secondary
    notifyFrame.Parent = game:GetService("CoreGui")

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -10, 0, 25)
    titleLabel.Position = UDim2.new(0, 5, 0, 5)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Theme.TextColor
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 16
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = notifyFrame

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, -10, 0, 25)
    textLabel.Position = UDim2.new(0, 5, 0, 30)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = text
    textLabel.TextColor3 = Theme.TextColor
    textLabel.Font = Enum.Font.Gotham
    textLabel.TextSize = 14
    textLabel.TextXAlignment = Enum.TextXAlignment.Left
    textLabel.Parent = notifyFrame

    spawn(function()
        wait(duration)
        notifyFrame:Destroy()
    end)
end

-- Theme Support
function NexusUI:SetTheme(newTheme)
    for k,v in pairs(newTheme) do
        Theme[k] = v
    end
end

return NexusUI
